version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Bootstrap Openstack Nodes
    task:
      jobs:
        - name: Run Terraform
          commands:
            - checkout
        - name: 'Job #2'
          commands:
            - ls -lah
            - terraform init -input=false
            - terraform validate
            - terraform plan -input=false -refresh-only
            - terraform apply -auto-approve -input=false
      env_vars:
        - name: OS_AUTH_URL
          value: 'https://iad2.dream.io:5000/v3'
        - name: OS_IDENTITY_API_VERSION
          value: '3'
        - name: OS_INTERFACE
          value: public
        - name: OS_REGION_NAME
          value: RegionOne
        - name: OS_USER_DOMAIN_NAME
          value: Default
      secrets:
        - name: Openstack Credentials
